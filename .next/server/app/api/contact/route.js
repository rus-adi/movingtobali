"use strict";(()=>{var e={};e.id=386,e.ids=[386],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},1053:(e,t,o)=>{o.r(t),o.d(t,{originalPathname:()=>w,patchFetch:()=>v,requestAsyncStorage:()=>g,routeModule:()=>f,serverHooks:()=>y,staticGenerationAsyncStorage:()=>b});var r={};o.r(r),o.d(r,{GET:()=>_,POST:()=>p});var n=o(9303),a=o(8716),s=o(3131),i=o(7070),c=o(4597),l=o(468);let m=new Map;function u(e,t){return(e||"").trim().slice(0,t)}async function d(e){let t=process.env.RESEND_API_KEY;if(!t)throw Error("Missing RESEND_API_KEY");let o=await fetch("https://api.resend.com/emails",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({from:e.from,to:[e.to],subject:e.subject,text:e.text})});if(!o.ok){let e=await o.text().catch(()=>"");throw Error(`Resend error: ${o.status} ${e}`.slice(0,500))}}async function h(e,t){let o=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!o.ok){let e=await o.text().catch(()=>"");throw Error(`Webhook error: ${o.status} ${e}`.slice(0,500))}}async function p(e){let t=(0,c.NP)();if(!function(e){let t=Date.now(),o=(m.get(e)||[]).filter(e=>t-e<36e5);return o.length>=5?(m.set(e,o),!1):(o.push(t),m.set(e,o),!0)}(function(e){let t=e.headers.get("x-forwarded-for");return t?t.split(",")[0]?.trim()||"unknown":e.headers.get("x-real-ip")||"unknown"}(e)))return i.NextResponse.json({ok:!1,code:"rate_limited",error:"Too many requests. Please email us instead."},{status:429,headers:{"Cache-Control":"no-store"}});let o=null;try{o=await e.json()}catch{o=null}if(!o)return i.NextResponse.json({ok:!1,code:"bad_json",error:"Invalid request."},{status:400,headers:{"Cache-Control":"no-store"}});if(u(o.company,120))return i.NextResponse.json({ok:!1,code:"spam",error:"Invalid request."},{status:400,headers:{"Cache-Control":"no-store"}});let r=u(o.topic,120)||"General question",n=u(o.from,200),a=u(o.partnerSlug,80),s=u(o.name,120),p=u(o.email,180),_=u(o.whatsapp,80),f=u(o.kidsAges,120),g=u(o.timeline,180),b=u(o.message,8e3);if(!p||!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(p)||!b)return i.NextResponse.json({ok:!1,code:"validation",error:"Please include a valid email and a short message."},{status:400,headers:{"Cache-Control":"no-store"}});let y=(0,l.qP)(),w=`Moving to Bali with Kids — ${r}`,v=["New message from movingtobali.empathy.school","",`Topic: ${r}`,a?`Partner: ${a}`:"",n?`Source page: ${n}`:"","",`Name: ${s||"(not provided)"}`,`Email: ${p}`,_?`WhatsApp/Phone: ${_}`:"",f?`Kids’ ages: ${f}`:"",g?`Timeline: ${g}`:"","","Message:",b,"","---","Attribution",(0,l.DU)(y)].filter(Boolean).join("\n"),x=(process.env.CONTACT_TO_EMAIL||t.brand.contactEmail||"").trim(),C=(process.env.CONTACT_FROM_EMAIL||t.brand.contactEmail||"").trim(),k=(process.env.CONTACT_WEBHOOK_URL||"").trim(),P=`mailto:${encodeURIComponent(x)}?subject=${encodeURIComponent(w)}&body=${encodeURIComponent(v)}`;try{if(k)return await h(k,{subject:w,topic:r,from:n,partnerSlug:a,name:s,email:p,whatsapp:_,kidsAges:f,timeline:g,message:b,attribution:y,ts:new Date().toISOString()}),i.NextResponse.json({ok:!0,mode:"webhook"},{headers:{"Cache-Control":"no-store"}});if(process.env.RESEND_API_KEY)return await d({to:x,from:C,subject:w,text:v}),i.NextResponse.json({ok:!0,mode:"resend"},{headers:{"Cache-Control":"no-store"}});return i.NextResponse.json({ok:!1,mode:"noop",code:"not_configured",error:"Contact delivery is not configured yet. Please email us instead.",fallbackMailto:P},{status:200,headers:{"Cache-Control":"no-store"}})}catch(e){return i.NextResponse.json({ok:!1,mode:"error",code:"send_failed",error:"Couldn’t send right now. Please email us instead.",fallbackMailto:P},{status:200,headers:{"Cache-Control":"no-store"}})}}function _(){return i.NextResponse.json({ok:!1,error:"Method not allowed"},{status:405})}let f=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/contact/route",pathname:"/api/contact",filename:"route",bundlePath:"app/api/contact/route"},resolvedPagePath:"/media/Data/PROJECTS/moving-to-bali-batch14-official-links-linkcheck/src/app/api/contact/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:g,staticGenerationAsyncStorage:b,serverHooks:y}=f,w="/api/contact/route";function v(){return(0,s.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:b})}},468:(e,t,o)=>{o.d(t,{DU:()=>s,kg:()=>i,qP:()=>a});var r=o(1615);let n={utm_source:"mtb_utm_source",utm_medium:"mtb_utm_medium",utm_campaign:"mtb_utm_campaign",utm_term:"mtb_utm_term",utm_content:"mtb_utm_content",gclid:"mtb_gclid",fbclid:"mtb_fbclid",first_landing:"mtb_first_landing",first_seen:"mtb_first_seen"};function a(){let e=(0,r.cookies)(),t={};return Object.keys(n).forEach(o=>{let r=e.get(n[o])?.value;r&&(t[o]=r)}),t}function s(e){let t=[],o=(e,o)=>{o&&t.push(`${e}: ${o}`)};return o("First landing",e.first_landing),o("First seen",e.first_seen),o("utm_source",e.utm_source),o("utm_medium",e.utm_medium),o("utm_campaign",e.utm_campaign),o("utm_term",e.utm_term),o("utm_content",e.utm_content),o("gclid",e.gclid),o("fbclid",e.fbclid),t.length?t.join("\n"):"No attribution cookies found."}function i(e,t){t.utm_source&&e.searchParams.set("mtb_in_utm_source",t.utm_source),t.utm_medium&&e.searchParams.set("mtb_in_utm_medium",t.utm_medium),t.utm_campaign&&e.searchParams.set("mtb_in_utm_campaign",t.utm_campaign),t.utm_term&&e.searchParams.set("mtb_in_utm_term",t.utm_term),t.utm_content&&e.searchParams.set("mtb_in_utm_content",t.utm_content),t.gclid&&e.searchParams.set("mtb_gclid",t.gclid),t.fbclid&&e.searchParams.set("mtb_fbclid",t.fbclid)}},4597:(e,t,o)=>{o.d(t,{GR:()=>s,NP:()=>n,$2:()=>a});let r=JSON.parse('{"brand":{"name":"Moving to Bali with Kids","tagline":"A calm, comprehensive guide for families relocating to Bali.","siteUrl":"https://movingtobali.empathy.school","publisherName":"Empathy School","publisherUrl":"https://empathy.school","contactEmail":"hello@empathy.school","social":{"instagram":"https://www.instagram.com/empathyschoolbali/","youtube":"https://www.youtube.com/@EmpathySchool"}},"seo":{"defaultTitle":"Moving to Bali with Kids (by Empathy School)","defaultDescription":"A practical, family-first guide to relocating to Bali: visas, housing, neighborhoods, learning, daily logistics, and what to do first.","keywords":["move to bali with kids","moving to bali","bali visas","where to live in bali","bali with children","bali cost of living","family life in bali"],"googleSiteVerification":""},"ctas":{"primary":{"text":"Start here","href":"/start-here"},"secondary":{"text":"Ask a question","href":"/contact"},"empathy":{"text":"Learn about Empathy School","href":"https://empathy.school"}}}');function n(){return r}function a(){let e="https://movingtobali.empathy.school";return e&&e.trim()||r.brand.siteUrl||"http://localhost:3000"}function s(e){let t=a().replace(/\/$/,""),o=e.startsWith("/")?e:`/${e}`;return`${t}${o}`}}};var t=require("../../../webpack-runtime.js");t.C(e);var o=e=>t(t.s=e),r=t.X(0,[948,564],()=>o(1053));module.exports=r})();